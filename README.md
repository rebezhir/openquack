# OpenQUACK: проект ПО для портативных радиостанций Quansheng UV-K5/UV-K5(8)/UV-5R PLUS/UV-K6
А также Anysecu UV-K5, Radtel RT-590 и так далее  

__ОТПРАВИТЬ БЛАГОДАРОЧКУ НА ПИВО: 2204 1201 0314 6060__  
[Канал в Telegram](https://t.me/openquack)  

![OpenQUACK](images/openquack.png)

Основан на коде https://github.com/DualTachyon и https://github.com/fagci  

__Несовместим со штатным CPS, требует установки [кастомного модуля CHIRP](https://github.com/rebezhir/openquack-chirp-driver) !!!__  
На время работы над прошивкой самой рации доработка модуля приостановлена.  

![OpenQUACK](images/work_in_progress.jpg)  
ПО рассчитано на использование рации именно как средства связи, при этом средства удобного.

Поэтому удаляется все ненужное:
* Экран приветствия, дающий секундную задержку при загрузке
* Прием FM-радио, для боковой клавиши в настройках CHIRP заменено на переключение A/B (также доступно через меню рации)
* Передача сигнала тревоги, для боковой клавиши в настройках CHIRP заменено на переключение VFO/MR (также доступно через меню рации)
* Прием NOAA по причине бесполезности в России
* Копирование по воздуху
* Киллкоды
* Соответствующие убираемым функциям пункты меню
* Озвучивание меню
  

# Добавлено: 
* Редактирование настроек боковых клавиш из меню рации

![OpenQUACK](images/keys.png)    

* Увеличено усиление микрофона
* Расширен диапазон настройки длительности подсветки
* Отключен тайм-аут сканирования частоты и субтона
* Горизонтальное меню V1.1  

![OpenQUACK](images/menu.png)  
* Расширенная блокировка кнопок (только цифровые / все, кроме PTT / все)  
* Переключение TDR по F+0 вместо радио  
* Встроенная калибровка вольтметра в скрытом меню (PTT+F1 при включении рации)
* Быстрый реверс смещения может назначаться на любую боковую кнопку через меню рации  


# ПОРЯДОК КАЛИБРОВКИ:
1. __Полностью__ зарядить батарею и __оставить рацию во включенном стакане__. При калибровке автоматически прописывается именно та настройка, при которой показания АЦП контроллера будут соответствовать 8,4 В.
2. Войти в инженерное меню рации, включив ее с одновременно нажатыми PTT и верхней боковой клавишей.
3. Перейти к пункту 60 меню.
4. Однократно нажать кнопку MENU, затем EXIT.
5. Выключить рацию и снова включить.

# КАЛИБРОВКА ШУМОПОДАВЛЕНИЯ:
Первый уровень у него штатно слишком тупой, умудряющийся запирать даже мощный сигнал. Но, поскольку все калибровки для уровней шумоподавления хранятся в EEPROM, а не зашиты во флеш, исправить это в самой прошивке можно только костылем, подменяющим данные при SQL=1. Поэтому в репозиторий [добавлены скрипты на Python](https://github.com/rebezhir/openquack/tree/main/squelch-tuner) для чтения и записи калибровок в рацию.
В консоли, открытой из папки squelch_tuner:
>python squelch_table_write.py COM5 (номер порта, естественно, должен соответствовать тому, на котором висит подключенный к рации шнур).

Настройки в файле для SQL=1 уже изменены.  
В файле можно поправить ВТОРЫЕ по порядку байты во всех элементах массива:

>uhf_squelch_open_rssi = bytearray([0x0a,__0x35__,0x53,0x56,0x59,0x5c,0x5f,0x62,0x64,0x66,0xff,0xff,0xff,0xff,0xff,0xff])  
uhf_squelch_close_rssi = bytearray([0x05,__0x30__,0x50,0x53,0x56,0x59,0x5c,0x5f,0x62,0x64,0xff,0xff,0xff,0xff,0xff,0xff])  
uhf_squelch_open_noise = bytearray([0x5a,__0x2a__,0x29,0x26,0x23,0x20,0x1d,0x1a,0x17,0x14,0xff,0xff,0xff,0xff,0xff,0xff])  
uhf_squelch_close_noise = bytearray([0x64,__0x2f__,0x2d,0x29,0x26,0x23,0x20,0x1d,0x1a,0x17,0xff,0xff,0xff,0xff,0xff,0xff])  
uhf_squelch_close_glitch = bytearray([0x5a,__0x12__,0x11,0x0e,0x0b,0x08,0x03,0x02,0x02,0x02,0xff,0xff,0xff,0xff,0xff,0xff])  
uhf_squelch_open_glitch = bytearray([0x64,__0x10__,0x0e,0x0b,0x08,0x05,0x05,0x04,0x04,0x04,0xff,0xff,0xff,0xff,0xff,0xff])  
vhf_squelch_open_rssi = bytearray([0x32,__0x58__,0x6b,0x6e,0x6f,0x72,0x75,0x77,0x79,0x7b,0xff,0xff,0xff,0xff,0xff,0xff])  
vhf_squelch_close_rssi = bytearray([0x28,__0x54__,0x67,0x6a,0x6c,0x6e,0x71,0x73,0x76,0x78,0xff,0xff,0xff,0xff,0xff,0xff])  
vhf_squelch_open_noise = bytearray([0x41,__0x39__,0x2d,0x28,0x24,0x21,0x1e,0x1a,0x17,0x16,0xff,0xff,0xff,0xff,0xff,0xff])  
vhf_squelch_close_noise = bytearray([0x46,__0x36__,0x32,0x2d,0x28,0x25,0x22,0x1e,0x1b,0x19,0xff,0xff,0xff,0xff,0xff,0xff])  
vhf_squelch_close_glitch = bytearray([0x5a,__0x12__,0x0f,0x0a,0x09,0x08,0x07,0x06,0x05,0x04,0xff,0xff,0xff,0xff,0xff,0xff])  
vhf_squelch_open_glitch = bytearray([0x64,__0x1e__,0x14,0x0f,0x0d,0x0c,0x0b,0x0a,0x09,0x08,0xff,0xff,0xff,0xff,0xff,0xff])  

Слева - заводские настройки, считанные через squelch_table_read.py с "чистой" рации, справа - с рации после применения скрипта. 

![OpenQUACK](images/comparison.png)  

# TODO:
* Русифицированное горизонтальное меню 
* Расширенный редактор в меню (названия каналов, сканлисты, список контактов и т.д.)

  




